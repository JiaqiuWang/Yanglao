

"""获取前缀索引的队列  返回值是 前缀索引队列 sequence：['支付服务', '慰藉服务']
   before_post_list: 支付服务的后缀List
   """
import time
import pymongo


def get_postfix_project_index_when_len_sequence_more(cursor_project, sequence, before_postfix_list):
    cursor_project.rewind()
    # 第一步：取出sequence序列中最后一个元素
    str_last_ele = sequence[-1]
    # 定义存放suffix的队列
    suffix_index = []
    # 第二部：查询每个before_postfix_list中index对应trans_no有无str_last_ele
    for var_start_index in before_postfix_list:
        single_doc = cursor_project.__getitem__(var_start_index - 1)  # 获取开始索引对应的document
        current_trans_no = single_doc.get("trans_no")  # 获取对应的trans_no
        # 获取开始索引对应的序列集合, _id生序排列
        collection_len = db.get_collection("fp_trans_p1")
        var_cursor_len = collection_len.find({"trans_no": current_trans_no, "service_name": str_last_ele,
                                              "_id": {"$gte": var_start_index}}).sort({"_id": 1})
        count_var_cursor = var_cursor_len.count()
        if count_var_cursor == 0:
            continue
        for part_doc in var_cursor_len:
            if part_doc.get("service_name") == str_last_ele:
                suffix_id = part_doc.get("_id") + 1
                if current_trans_no == cursor_project.__getitem__(suffix_id - 1).get("trans_no"):
                    suffix_index.append(suffix_id)



if __name__ == "__main__":
    # 记录算法运行开始时间
    start_time = time.clock()
    # main_operation
    client = pymongo.MongoClient("127.0.0.1", 27017)  # ip或者127.0.0.1
    db = client.get_database("yanglao")
    collection = db.get_collection("fp_trans_p1")
    # var_cursor = collection.find({"pPer_id": self.uid}).limit(100)  # 查找一个人的所有记录
    var_cursor = collection.find({"pPer_id": "p1"})  # 查找一个人的所有记录
    list_project = [2, 20, 28, 39, 42, 47, 51, 54, 56, 63, 72, 78, 81, 102, 104, 114, 116, 123, 128, 133, 144, 147, 155, 166, 182, 186, 188, 195, 209, 220, 225, 239, 244, 255, 259, 265, 269, 272, 275, 290, 299, 303, 313, 318, 328, 332, 344, 351, 353, 357, 363, 368, 371, 377, 381, 386, 392, 400, 404, 406, 411, 413, 425, 434, 443, 445, 453, 458, 461, 468, 471, 474, 477, 494, 497, 505, 510, 515, 521, 528, 530, 546, 549, 555, 559, 565, 569, 577, 582, 588, 593, 597, 599, 609, 613, 615, 619, 632, 636, 644, 647, 650, 658, 661, 668, 675, 688, 696, 703, 710, 715, 737, 741, 743, 747, 758, 762, 764, 771, 783, 792, 798, 811, 814, 827, 831, 838, 843, 846, 850, 865, 868, 881, 885, 892, 899, 908, 911, 920, 936, 942, 946, 959, 968, 988, 995, 998, 1011, 1013, 1026, 1029, 1033, 1036, 1041, 1051, 1056, 1066, 1069, 1079, 1089, 1092, 1111, 1115, 1118, 1120, 1131, 1138, 1141, 1144, 1147, 1153, 1155, 1159, 1162, 1174, 1178, 1180, 1190, 1197, 1206, 1211, 1232, 1244, 1247, 1251, 1260, 1267, 1271, 1283, 1287, 1298, 1303, 1320, 1323, 1328, 1338, 1345, 1349, 1362, 1375, 1384, 1388, 1390, 1411, 1415, 1430, 1435, 1447, 1451, 1456, 1460, 1463, 1467, 1471, 1477, 1487, 1492, 1498, 1503, 1508, 1511, 1515, 1520, 1527, 1531, 1536, 1540, 1544, 1549, 1552, 1566, 1568, 1585, 1595, 1599, 1606, 1610, 1614, 1621, 1629, 1637, 1644, 1652, 1656, 1661, 1683, 1690, 1697, 1701, 1710, 1713, 1719, 1733, 1743, 1756, 1762, 1766, 1769, 1771, 1777, 1782, 1798, 1805, 1812, 1814, 1823, 1832, 1844, 1848, 1851, 1855, 1864, 1868, 1872, 1879, 1885, 1889, 1898, 1906, 1913, 1931, 1940, 1954, 1962, 1968, 1972, 1976, 1981, 1984, 1991, 1995, 2002, 2006, 2010, 2022, 2029, 2032, 2037, 2039, 2044, 2046, 2052, 2054, 2062, 2065, 2077, 2083, 2085, 2091, 2098, 2102, 2110, 2122, 2128, 2138, 2144, 2146, 2152, 2154, 2157, 2163, 2165, 2178, 2183, 2190, 2194, 2198, 2207, 2209, 2219, 2226, 2233, 2241, 2243, 2255, 2261, 2265, 2270, 2275, 2289, 2292, 2296, 2306, 2310, 2320, 2324, 2334, 2338, 2345, 2347, 2351, 2353, 2363, 2377, 2380, 2387, 2390, 2405, 2412, 2415, 2425, 2440, 2443, 2466, 2474, 2478, 2481, 2490, 2495, 2501, 2510, 2517, 2524, 2535, 2539, 2552, 2558, 2566, 2571, 2588, 2593, 2599, 2604, 2606, 2611, 2619, 2646, 2652, 2656, 2664, 2672, 2674, 2679, 2686, 2693, 2696, 2704, 2725, 2733, 2739, 2746, 2750, 2754, 2760, 2762, 2773, 2780, 2786, 2790, 2796, 2800, 2803, 2808, 2815, 2826, 2833, 2838, 2843, 2849, 2860, 2871, 2877, 2880, 2890, 2893, 2898, 2900, 2922, 2926, 2939, 2950, 2956, 2970, 2975, 2993, 2996, 3003, 3007, 3011, 3014, 3016, 3032, 3038, 3046, 3057, 3060, 3068, 3076, 3079, 3089, 3102, 3112, 3120, 3125, 3142, 3157, 3159, 3167, 3169, 3173, 3177, 3182, 3185, 3191, 3193, 3196, 3199, 3207, 3212, 3223, 3228, 3243, 3246, 3255, 3261, 3265, 3268, 3270, 3275, 3280, 3287, 3291, 3293, 3295, 3298, 3315, 3319, 3322, 3329, 3335, 3343, 3353, 3368, 3373, 3375, 3386, 3408, 3411, 3420, 3422, 3432, 3436, 3442, 3455, 3458, 3477, 3479, 3491, 3503, 3516, 3520, 3538, 3548, 3551, 3554, 3567, 3576, 3587, 3600, 3608, 3615, 3635, 3646, 3656, 3671, 3685, 3697, 3706, 3722, 3725, 3728, 3731, 3740, 3746, 3749, 3754, 3759, 3775, 3778, 3794, 3806, 3815, 3819, 3821, 3830, 3843, 3853, 3862, 3874, 3878, 3892, 3895, 3900, 3913, 3916, 3931, 3944, 3978, 3986, 3995, 3997, 4004, 4024, 4029, 4039, 4049, 4052, 4055, 4058, 4061, 4064, 4067, 4070, 4073, 4078, 4094, 4098, 4107, 4115, 4119, 4139, 4145, 4152, 4157, 4160, 4164, 4168, 4172, 4174, 4179, 4187, 4191, 4196, 4200, 4208, 4215, 4221, 4238, 4240, 4242, 4246, 4256, 4263, 4269, 4271, 4274, 4290, 4294, 4296, 4310, 4321, 4324, 4328, 4339, 4343, 4348, 4354, 4365, 4378, 4385, 4391, 4402, 4405, 4415, 4419, 4422, 4434, 4440, 4448, 4471, 4480, 4487, 4500, 4506, 4518, 4524, 4527, 4535, 4538, 4552, 4554, 4566, 4571, 4577, 4588, 4599, 4605, 4610, 4613, 4630, 4669, 4697, 4705, 4709, 4712, 4718, 4725, 4729, 4733, 4737, 4749, 4753, 4761, 4764, 4770, 4772, 4775, 4778, 4784, 4795, 4797, 4809, 4812, 4815, 4820, 4831, 4837, 4844, 4858, 4864, 4878, 4883, 4885, 4888, 4898, 4904, 4907, 4910, 4916, 4922, 4927, 4950, 4953, 4962, 4969, 4978, 4984, 4993, 5015, 5017, 5021, 5024, 5032, 5040, 5042, 5045, 5051, 5059, 5062, 5075, 5077, 5084, 5095, 5109, 5113, 5118, 5121, 5128, 5133, 5139, 5144, 5155, 5158, 5165, 5173, 5181, 5199, 5209, 5212, 5218, 5220, 5223, 5232, 5237, 5241, 5247, 5253, 5255, 5260, 5268, 5272, 5277, 5282, 5288, 5293, 5295, 5301, 5304, 5313, 5331, 5333, 5337, 5348, 5352, 5358, 5363, 5377, 5380, 5386, 5388, 5392, 5399, 5402, 5407, 5418, 5424, 5435, 5440, 5447, 5450, 5464, 5475, 5489, 5498, 5504, 5510, 5522, 5527, 5533, 5547, 5555, 5566, 5572, 5575, 5578, 5585, 5590, 5597, 5603, 5606, 5609, 5623, 5628, 5633, 5642, 5650, 5654, 5660, 5662, 5677, 5687, 5689, 5701, 5705, 5708, 5718, 5720, 5723, 5733, 5744, 5755, 5766, 5772, 5785, 5794, 5802, 5804, 5806, 5814, 5821, 5825, 5834, 5836, 5840, 5848, 5854, 5857, 5860, 5866, 5875, 5881, 5884, 5909, 5916, 5925, 5933, 5942, 5950, 5954, 5965, 5971, 5985, 5990, 5993, 5998, 6003, 6009, 6015, 6021, 6029, 6034, 6038, 6044, 6054, 6057, 6062, 6067, 6070, 6075, 6087, 6091, 6096, 6101, 6106, 6110, 6117, 6121, 6130, 6147, 6152, 6154, 6159, 6167, 6172, 6175, 6205, 6216, 6222, 6226, 6234, 6238, 6243, 6248, 6252, 6256, 6264, 6268, 6279, 6282, 6284, 6288, 6294, 6297, 6306, 6322, 6325, 6329, 6347, 6352, 6356, 6359, 6365, 6374, 6381, 6385, 6390, 6393, 6400, 6407, 6415, 6423, 6428, 6433, 6435, 6438, 6442, 6453, 6458, 6464, 6468, 6474, 6478, 6483, 6487, 6494, 6497, 6510, 6516, 6520, 6526, 6534, 6537, 6551, 6556, 6566, 6572, 6575, 6579, 6586, 6589, 6592, 6604, 6607, 6615, 6627, 6630, 6639, 6645, 6650, 6658, 6662, 6665, 6687, 6699, 6711, 6713, 6716, 6722, 6726, 6733, 6737, 6743, 6747, 6755, 6775, 6777, 6782, 6786, 6789, 6796, 6798, 6801, 6806, 6814, 6819, 6825, 6840, 6846, 6856, 6863, 6865, 6870, 6883, 6890, 6896, 6900, 6910, 6913, 6918, 6941, 6945, 6958, 6962, 6964, 6971, 6977, 6986, 6993, 7005, 7007, 7012, 7017, 7025, 7031, 7037, 7040, 7043, 7049, 7055, 7070, 7073, 7077, 7080, 7086, 7093, 7102, 7104, 7109, 7116, 7122, 7126, 7137, 7141, 7147, 7151, 7167, 7171, 7175, 7179, 7197, 7226, 7238, 7243, 7245, 7250, 7253, 7260, 7266, 7271, 7273, 7286, 7295, 7308, 7311, 7333, 7338, 7347, 7355, 7361, 7366, 7371, 7377, 7382, 7385, 7395, 7400, 7406, 7409, 7411, 7418, 7422, 7428, 7440, 7457, 7462, 7465, 7472, 7475, 7483, 7488, 7492, 7498, 7504, 7508, 7512, 7518, 7522, 7533, 7543, 7546, 7550, 7553, 7563, 7574, 7580, 7597, 7601, 7603, 7607, 7612, 7616, 7619, 7634, 7636, 7644, 7649, 7664, 7673, 7680, 7682, 7693, 7697, 7715, 7724, 7751, 7762, 7767, 7778, 7784, 7791, 7800, 7807, 7822, 7830, 7834, 7842, 7855, 7857, 7861, 7867, 7875, 7880, 7884, 7894, 7898, 7907, 7917, 7920, 7926, 7930, 7933, 7937, 7946, 7953, 7959, 7964, 7968, 7982, 7988, 7990, 7997, 8003, 8005, 8011, 8013, 8025, 8028, 8030, 8033, 8039, 8062, 8074, 8080, 8114, 8119, 8121, 8131, 8143, 8145, 8161, 8167, 8171, 8181, 8186, 8196, 8209, 8217, 8227, 8231, 8237, 8243, 8246, 8254, 8258, 8265, 8271, 8277, 8284, 8298, 8304, 8307, 8309, 8317, 8323, 8326, 8335, 8345, 8347, 8351, 8359, 8375, 8381, 8385, 8388, 8391, 8397, 8402, 8411, 8425, 8440, 8447, 8451, 8459, 8464, 8468, 8477, 8481, 8491, 8494, 8502, 8509, 8512, 8515, 8527, 8533, 8542, 8544, 8554, 8570, 8576, 8580, 8583, 8588, 8595, 8597, 8600, 8606, 8609, 8615, 8624, 8629, 8641, 8645, 8651, 8657, 8661, 8671, 8679, 8684, 8695, 8701, 8704, 8707, 8715, 8719, 8732, 8739, 8745, 8757, 8763, 8765, 8775, 8780, 8796, 8801, 8806, 8810, 8812, 8817, 8821, 8828, 8833, 8850, 8855, 8873, 8886, 8893, 8896, 8900, 8932, 8948, 8957, 8962, 8973, 8979, 8986, 8991, 8999, 9004, 9017, 9020, 9031, 9036, 9041, 9045, 9055, 9059, 9065, 9069, 9072, 9079, 9083, 9093, 9108, 9112, 9117, 9122, 9135, 9138, 9146, 9158, 9173, 9180, 9183, 9188, 9199, 9205, 9209, 9212, 9224, 9229, 9235, 9246, 9252, 9257, 9261, 9269, 9275, 9282, 9289, 9295, 9299, 9302, 9309, 9312, 9317, 9321, 9327, 9330, 9346, 9352, 9368, 9379, 9389, 9391, 9398, 9415, 9431, 9437, 9444, 9452, 9467, 9470, 9500, 9506, 9509, 9514, 9521, 9526, 9530, 9538, 9553, 9564, 9568, 9580, 9583, 9604, 9607, 9612, 9618, 9620, 9625, 9651, 9654, 9664, 9669, 9673, 9677, 9681, 9686, 9690, 9696, 9699, 9712, 9717, 9737, 9742, 9748, 9752, 9762, 9771, 9775, 9782, 9788, 9792, 9804, 9814, 9826, 9838, 9846, 9851, 9853, 9862, 9867, 9876, 9884, 9899, 9902, 9904, 9923, 9931, 9933, 9938, 9945, 9949, 9952, 9955, 9963, 9976, 9986, 9991, 10000, 10022, 10031, 10040, 10044, 10046, 10051, 10072, 10078, 10086, 10091, 10095, 10101, 10109, 10116, 10125, 10129, 10133, 10138, 10140, 10144, 10149, 10156, 10159, 10178, 10180, 10184, 10195, 10201, 10204, 10210, 10212, 10221, 10225, 10243, 10252, 10265, 10283, 10298, 10301, 10304, 10310, 10319, 10328, 10335, 10338, 10343, 10346, 10351, 10356, 10361, 10367, 10369, 10376, 10384, 10388, 10391, 10395, 10399, 10410, 10414, 10417, 10422, 10426, 10432, 10441, 10450, 10461, 10468, 10474, 10476, 10492, 10495, 10509, 10518, 10525, 10531, 10538, 10542, 10544, 10550, 10553, 10560, 10568, 10588, 10596, 10604, 10607, 10614, 10617, 10624, 10639, 10643, 10668, 10672, 10685, 10690, 10694, 10702, 10706, 10717, 10729, 10733, 10735, 10742, 10749, 10754, 10759, 10762, 10780, 10786, 10791, 10801, 10806, 10812, 10816, 10822, 10830, 10844, 10848, 10852, 10856, 10864, 10867, 10876, 10886, 10889, 10891, 10895, 10907, 10919, 10922, 10939, 10942, 10953, 10957, 10970, 10981, 10991, 10994, 10999, 11004, 11011, 11015, 11017, 11025, 11027, 11034, 11041, 11051, 11053, 11060, 11067, 11077, 11088, 11095, 11101, 11104, 11108, 11111, 11120, 11130, 11141, 11149, 11151, 11156, 11161, 11164, 11178, 11181, 11185, 11193, 11199, 11204, 11217, 11225, 11229, 11237, 11244, 11255, 11257, 11264, 11268, 11270, 11273, 11276, 11278, 11282, 11291, 11295, 11304, 11311, 11317, 11327, 11339, 11345, 11348, 11354, 11366, 11373, 11378, 11394, 11405, 11417, 11426, 11430, 11436, 11445, 11448, 11453, 11459, 11464, 11472, 11477, 11483, 11485, 11489, 11497, 11503, 11507, 11515, 11519, 11524, 11528, 11545, 11553, 11561, 11563, 11565, 11588, 11593, 11601, 11609, 11616, 11627, 11633, 11636, 11638, 11651, 11655, 11657, 11660, 11665, 11674, 11681, 11688, 11695, 11701, 11707, 11712, 11719, 11725, 11739, 11742, 11746, 11749, 11758, 11767, 11770, 11773, 11777, 11782, 11788, 11793, 11795, 11807, 11810, 11815, 11818, 11821, 11823, 11826, 11829, 11834, 11840, 11847, 11849, 11859, 11867, 11871, 11884, 11889, 11918, 11924, 11927, 11932, 11935, 11942, 11945, 11962, 11978, 11980, 11985, 11996, 11998, 12002, 12012, 12025, 12032, 12038, 12041, 12065, 12069, 12075, 12085, 12109, 12116, 12120, 12123, 12132, 12142, 12154, 12161, 12165, 12192, 12205, 12210, 12213, 12218, 12223, 12230, 12248, 12256, 12271, 12288, 12290, 12304, 12307, 12310, 12317, 12322, 12324, 12342, 12346, 12348, 12352, 12360, 12366, 12372, 12375, 12399, 12405, 12408, 12411, 12417, 12424, 12429, 12437, 12440, 12445, 12455, 12462, 12466, 12471, 12477, 12491, 12498, 12504, 12508, 12511, 12519, 12532, 12538, 12542, 12559, 12563, 12569, 12578, 12591, 12593, 12596, 12600, 12611, 12627, 12631, 12635, 12639, 12648, 12657, 12671, 12677, 12679, 12687, 12692, 12695, 12702, 12710, 12713, 12717, 12724, 12730, 12734, 12738, 12748, 12761, 12768, 12775, 12781, 12785, 12799, 12804, 12811, 12820, 12832, 12835, 12839, 12845, 12854, 12858, 12865, 12873, 12894, 12905, 12913, 12933, 12940, 12950, 12965, 12973, 12976, 12981, 12983, 12996, 13002, 13010, 13022, 13038, 13041, 13044, 13050, 13056, 13062, 13071, 13084, 13092, 13105, 13110, 13116, 13120, 13125, 13127, 13135, 13159, 13167, 13170, 13173, 13187, 13199, 13202, 13208, 13210, 13215, 13226, 13231, 13235, 13238, 13244, 13246, 13259, 13263, 13276, 13280, 13285, 13289, 13295, 13297, 13303, 13324, 13326, 13329, 13337, 13344, 13356, 13360, 13366, 13370, 13378, 13383, 13387, 13395, 13399, 13404, 13408, 13418, 13423, 13431, 13436, 13444, 13454, 13462, 13471, 13480, 13484, 13490, 13496, 13506, 13509, 13517, 13520, 13527, 13532, 13539, 13544, 13546, 13555, 13562, 13567, 13575, 13581, 13586, 13591, 13594, 13598, 13626, 13628, 13640, 13650, 13658, 13663, 13675, 13681, 13692, 13712, 13716, 13728, 13740, 13755, 13759, 13762, 13771, 13773, 13793, 13799, 13812, 13820, 13825, 13836, 13842, 13847, 13856, 13867, 13876, 13880, 13897, 13912, 13918, 13937, 13942, 13948, 13950, 13954, 13957, 13967, 13972, 13975, 13985, 13989, 13999, 14002, 14015, 14029, 14043, 14046, 14065, 14070, 14079, 14096, 14100, 14104, 14110, 14114, 14128, 14135, 14138, 14154, 14163, 14171, 14179, 14181, 14203, 14206, 14212, 14219, 14221, 14233, 14236, 14239, 14245, 14251, 14256, 14258, 14267, 14274, 14278, 14281, 14291, 14295, 14302, 14306, 14317, 14325, 14330, 14336, 14347, 14366, 14376, 14387, 14398, 14400, 14403, 14406, 14412, 14424, 14433, 14443, 14456, 14463, 14470, 14473, 14477, 14482, 14489, 14501, 14504, 14516, 14524, 14526, 14542, 14550, 14557, 14561, 14564, 14571, 14585, 14591, 14608, 14613, 14621, 14625, 14631, 14643, 14649, 14657, 14668, 14678, 14689, 14692, 14704, 14730, 14746, 14749, 14757, 14767, 14770, 14774, 14783, 14790, 14808, 14818, 14820, 14836, 14843, 14850, 14852, 14861, 14866, 14870, 14882, 14891, 14907, 14912, 14916, 14925, 14945, 14954, 14957, 14968, 14970, 14974, 14995, 15001, 15012, 15015, 15038, 15043, 15048, 15051, 15055, 15072, 15080, 15083, 15085, 15097, 15101]
    get_postfix_project_index_when_len_sequence_more(var_cursor, ['支付服务', '精神慰藉服务'], list_project)
    # 记录算法运行开始时间
    end_time = time.clock()
    print("Running time: %s Seconds" % (end_time - start_time))  # 输出运行时间